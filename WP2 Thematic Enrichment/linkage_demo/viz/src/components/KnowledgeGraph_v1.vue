<template>
  <div>
    <svg></svg>
  </div>
</template>
<script>
import * as d3 from "d3";
import { triplesToGraph } from "@/components/functions/triplesToGraph";

export default {
  mounted() {
    const width = 800;
    const height = 500;
    const triples = [
      {
        subject: "<cityobject/2>",
        predicate: "a",
        object: "bldg:Building",
      },
      {
        subject: "<cityobject/2>",
        predicate: "bldg:measuredHeight",
        object: "18.42",
      },
      {
        subject: "<cityobject/2>",
        predicate: "bldg:address",
        object: "<address/2>",
      },
      {
        subject: "<address/2>",
        predicate: "rdfs:label",
        object: "Rückertstraße 9",
      },
      {
        subject: "<cityobject/2>",
        predicate: "bldg:lod2Solid",
        object: "<solidgeometry/1>",
      },
      { subject: "<solidgeometry/1>", predicate: "geo:asWKT", object: "POLYHEDRALSURFACE Z (((11.554166670107218 48.132998707806316 520.83,11.554311282036217 48.13310609467417 520.83,11.554311282036217 48.13310609467417 535.114,11.554237412863568 48.13305123929875 539.25,11.554166670107218 48.132998707806316 535.289,11.554166670107218 48.132998707806316 520.83)),((11.554087684206333 48.133046326757814 520.83,11.554087684206333 48.133046326757814 535.289,11.554114380481519 48.13306612246275 536.783,11.554114380481519 48.13306612246275 520.83,11.554087684206333 48.133046326757814 520.83)),((11.554159100627002 48.13319585917616 534.65,11.554159100627002 48.13319585917616 520.83,11.554042686858624 48.13310927820526 520.83,11.554042686858624 48.13310927820526 534.65,11.554159100627002 48.13319585917616 534.65)),((11.554159100627002 48.13319585917616 534.65,11.554042686858624 48.13310927820526 534.65,11.554085523286725 48.13308350033671 536.781,11.554179126061682 48.133086376746554 539.25,11.554170013194117 48.13318985782319 535.172,11.554159100627002 48.13319585917616 534.65)),((11.554166670107218 48.132998707806316 520.83,11.554087684206333 48.133046326757814 520.83,11.554114380481519 48.13306612246275 520.83,11.554042686858624 48.13310927820526 520.83,11.554159100627002 48.13319585917616 520.83,11.554226460397718 48.13315881936383 520.83,11.554241009312499 48.13316921237891 520.83,11.554288698329755 48.133139646361975 520.83,11.554274131080692 48.13312915478319 520.83,11.554311282036217 48.13310609467417 520.83,11.554166670107218 48.132998707806316 520.83)),((11.554274646163453 48.1331295122444 535.06,11.554274131080692 48.13312915478319 535.087,11.554274131080692 48.13312915478319 520.83,11.554288698329755 48.133139646361975 520.83,11.554288698329755 48.133139646361975 535.046,11.554274646163453 48.1331295122444 535.06)),((11.554288528686948 48.13313974911199 535.055,11.554241009312499 48.13316921237891 535.02,11.554237832008933 48.13316694356995 535.196,11.554237752608833 48.133136091377246 536.5,11.554288528686948 48.13313974911199 535.055)),((11.554274646163453 48.1331295122444 535.06,11.554288698329755 48.133139646361975 535.046,11.554288528686948 48.13313974911199 535.055,11.554237752608833 48.133136091377246 536.5,11.554223656649787 48.13312561630536 536.501,11.554274646163453 48.1331295122444 535.06)),((11.554288698329755 48.133139646361975 520.83,11.554241009312499 48.13316921237891 520.83,11.554241009312499 48.13316921237891 535.02,11.554288528686948 48.13313974911199 535.055,11.554288698329755 48.133139646361975 535.046,11.554288698329755 48.133139646361975 520.83)),((11.554237412863568 48.13305123929875 539.25,11.554311282036217 48.13310609467417 535.114,11.554274131080692 48.13312915478319 535.087,11.554274646163453 48.1331295122444 535.06,11.554223656649787 48.13312561630536 536.501,11.554224118093556 48.13316010417053 535.054,11.554170013194117 48.13318985782319 535.172,11.554179126061682 48.133086376746554 539.25,11.554237412863568 48.13305123929875 539.25)),((11.554042686858624 48.13310927820526 520.83,11.554114380481519 48.13306612246275 520.83,11.554114380481519 48.13306612246275 536.783,11.554085523286725 48.13308350033671 536.781,11.554042686858624 48.13310927820526 534.65,11.554042686858624 48.13310927820526 520.83)),((11.554274131080692 48.13312915478319 535.087,11.554311282036217 48.13310609467417 535.114,11.554311282036217 48.13310609467417 520.83,11.554274131080692 48.13312915478319 520.83,11.554274131080692 48.13312915478319 535.087)),((11.554087684206333 48.133046326757814 535.289,11.554087684206333 48.133046326757814 520.83,11.554166670107218 48.132998707806316 520.83,11.554166670107218 48.132998707806316 535.289,11.554087684206333 48.133046326757814 535.289)),((11.554224118093556 48.13316010417053 535.054,11.554226460397718 48.13315881936383 535.182,11.554226460397718 48.13315881936383 520.83,11.554159100627002 48.13319585917616 520.83,11.554159100627002 48.13319585917616 534.65,11.554170013194117 48.13318985782319 535.172,11.554224118093556 48.13316010417053 535.054)),((11.554237832008933 48.13316694356995 535.196,11.554241009312499 48.13316921237891 535.02,11.554241009312499 48.13316921237891 520.83,11.554226460397718 48.13315881936383 520.83,11.554226460397718 48.13315881936383 535.182,11.554237832008933 48.13316694356995 535.196)),((11.554087684206333 48.133046326757814 535.289,11.554166670107218 48.132998707806316 535.289,11.554237412863568 48.13305123929875 539.25,11.554179126061682 48.133086376746554 539.25,11.554085523286725 48.13308350033671 536.781,11.554114380481519 48.13306612246275 536.783,11.554087684206333 48.133046326757814 535.289)),((11.554237832008933 48.13316694356995 535.196,11.554226460397718 48.13315881936383 535.182,11.554224118093556 48.13316010417053 535.054,11.554223656649787 48.13312561630536 536.501,11.554237752608833 48.133136091377246 536.5,11.554237832008933 48.13316694356995 535.196)))" },
    ];

    var graph = triplesToGraph(triples);
    const svg = d3.select("svg").attr("width", width).attr("height", height);

    var force = d3.forceSimulation(graph.nodes);

    function dragstart() {
      d3.select(this).classed("fixed", true);
    }

    function clamp(x, lo, hi) {
      return x < lo ? lo : x > hi ? hi : x;
    }

    function dragged(event, d) {
      d.fx = clamp(event.x, 0, width);
      d.fy = clamp(event.y, 0, height);
      force.alpha(1).restart();
    }

    const drag = d3.drag().on("start", dragstart).on("drag", dragged);

    svg
        .append("svg:defs")
        .selectAll("marker")
        .data(["end"])
        .enter()
        .append("svg:marker")
        .attr("id", String)
        .attr("viewBox", "0 -5 10 10")
        .attr("refX", 30)
        .attr("refY", -0.5)
        .attr("markerWidth", 6)
        .attr("markerHeight", 6)
        .attr("orient", "auto")
        .append("svg:polyline")
        .attr("points", "0,-5 10,0 0,5");

    var links = svg
        .selectAll(".link")
        .data(graph.links)
        .enter()
        .append("line")
        .attr("marker-end", "url(#end)")
        .attr("class", "link")
        .attr("stroke-width", 1); //links
    // ==================== Add Link Names =====================
    var linkTexts = svg
        .selectAll(".link-text")
        .data(graph.links)
        .enter()
        .append("text")
        .attr("class", "link-text")
        .text(function (d) {
          return d.predicate;
        });
    // ==================== Add Link Names =====================
    var nodeTexts = svg
        .selectAll(".node-text")
        .data(graph.nodes)
        .enter()
        .append("text")
        .attr("class", "node-text")
        .text(function (d) {
          return d.label;
        });
    // ==================== Add Node =====================
    var nodes = svg
        .selectAll(".node")
        .data(graph.nodes)
        .enter()
        .append("circle")
        .attr("class", "node")
        .attr("r", 8)
        .call(drag);

    function ticked() {
      nodes
          .attr("cx", function (d) {
            return d.x;
          })
          .attr("cy", function (d) {
            return d.y;
          });

      links
          .attr("x1", function (d) {
            return d.source.x;
          })
          .attr("y1", function (d) {
            return d.source.y;
          })
          .attr("x2", function (d) {
            return d.target.x;
          })
          .attr("y2", function (d) {
            return d.target.y;
          });

      nodeTexts
          .attr("x", function (d) {
            return d.x + 12;
          })
          .attr("y", function (d) {
            return d.y + 3;
          });

      linkTexts
          .attr("x", function (d) {
            return 4 + (d.source.x + d.target.x) / 2;
          })
          .attr("y", function (d) {
            return 4 + (d.source.y + d.target.y) / 2;
          });
    }

    force.on("tick", ticked);

    force
        .force(
            "link",
            d3.forceLink(graph.links).id((d) => d.id)
        )
        .force("charge", d3.forceManyBody())
        .force("center", d3.forceCenter(width / 2, height / 2));
  },
};
</script>
<style type="text/css">
.node {
  stroke: #fff;
  fill: #ddd;
  stroke-width: 1.5px;
}

.link {
  stroke: #999;
  stroke-opacity: 0.6;
  stroke-width: 1px;
}

marker {
  stroke: #999;
  fill: rgba(124, 240, 10, 0);
}

.node-text {
  font: 11px sans-serif;
  fill: black;
}

.link-text {
  font: 9px sans-serif;
  fill: grey;
}

svg {
  border: 1px solid black;
}
</style>